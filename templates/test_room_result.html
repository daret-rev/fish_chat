{% extends 'base.html' %}
{% block title %}–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è{% endblock %}

{% block content %}
<style>
    :root {
        --primary-color: #6f42c1;
        --primary-light: #8a63d2;
        --primary-dark: #5a32a3;
        --secondary-color: #20c997;
        --accent-color: #ff6b6b;
        --warning-color: #ffc107;
        --text-primary: #2c3e50;
        --text-secondary: #6c757d;
        --light-bg: #f8f9fa;
        --white: #ffffff;
        --shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        --shadow-hover: 0 8px 30px rgba(0, 0, 0, 0.12);
        --border-radius: 16px;
        --transition: all 0.3s ease;
    }

    .results-container {
        max-width: 800px;
        margin: 0 auto;
        padding: 40px 20px;
        min-height: 100vh;
        text-align: center;
    }

    .completion-header {
        margin-bottom: 50px;
        animation: fadeInDown 0.8s ease;
    }

    .completion-icon {
        font-size: 6rem;
        color: var(--accent-color);
        margin-bottom: 30px;
        animation: float 3s ease-in-out infinite;
    }

    .completion-title {
        font-size: 3rem;
        font-weight: 800;
        color: var(--text-primary);
        margin-bottom: 20px;
        line-height: 1.2;
        background: linear-gradient(135deg, var(--accent-color), #ff8e53);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .completion-subtitle {
        font-size: 1.3rem;
        color: var(--text-secondary);
        max-width: 600px;
        margin: 0 auto;
        line-height: 1.6;
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 25px;
        margin-bottom: 50px;
    }

    .stat-card {
        background: var(--white);
        border-radius: var(--border-radius);
        padding: 35px 25px;
        box-shadow: var(--shadow);
        transition: var(--transition);
        text-align: center;
        animation: fadeInUp 0.6s ease;
        animation-fill-mode: both;
    }

    .stat-card:nth-child(1) { animation-delay: 0.2s; }
    .stat-card:nth-child(2) { animation-delay: 0.4s; }
    .stat-card:nth-child(3) { animation-delay: 0.6s; }

    .stat-card:hover {
        transform: translateY(-10px);
        box-shadow: var(--shadow-hover);
    }

    .stat-icon {
        font-size: 2.5rem;
        margin-bottom: 20px;
        display: block;
    }

    .stat-value {
        font-size: 2.8rem;
        font-weight: 800;
        color: var(--text-primary);
        margin-bottom: 10px;
        line-height: 1;
    }

    .stat-label {
        font-size: 1.1rem;
        color: var(--text-secondary);
        font-weight: 500;
    }

    .stat-description {
        font-size: 0.9rem;
        color: var(--text-secondary);
        margin-top: 10px;
        opacity: 0.8;
    }

    .xp-container {
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        border-radius: var(--border-radius);
        padding: 40px;
        margin-bottom: 50px;
        border: 2px solid var(--accent-color);
        position: relative;
        overflow: hidden;
        animation: fadeInUp 0.8s ease 0.8s both;
    }

    .xp-container::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, var(--accent-color), #ff8e53);
    }

    .xp-header {
        margin-bottom: 30px;
    }

    .xp-title {
        font-size: 2rem;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 15px;
    }

    .xp-value {
        font-size: 4rem;
        font-weight: 900;
        color: var(--accent-color);
        margin: 20px 0;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
    }

    .xp-bar {
        height: 12px;
        background: var(--light-bg);
        border-radius: 6px;
        overflow: hidden;
        margin: 30px 0;
    }

    .xp-fill {
        height: 100%;
        background: linear-gradient(90deg, var(--accent-color), #ff8e53);
        border-radius: 6px;
        transition: width 1.5s ease;
    }

    .performance-box {
        background: var(--white);
        border-radius: var(--border-radius);
        padding: 40px;
        margin-bottom: 50px;
        box-shadow: var(--shadow);
        animation: fadeInUp 0.8s ease 1s both;
        border-left: 6px solid var(--secondary-color);
    }

    .performance-title {
        font-size: 1.8rem;
        color: var(--text-primary);
        margin-bottom: 25px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 15px;
    }

    .performance-message {
        font-size: 1.2rem;
        line-height: 1.7;
        color: var(--text-secondary);
        max-width: 600px;
        margin: 0 auto;
    }

    .buttons-container {
        display: flex;
        justify-content: center;
        gap: 25px;
        margin-top: 50px;
        flex-wrap: wrap;
        animation: fadeInUp 0.8s ease 1.2s both;
    }

    .action-button {
        padding: 20px 45px;
        font-size: 1.2rem;
        font-weight: 700;
        border: none;
        border-radius: 50px;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        gap: 15px;
        text-decoration: none;
    }

    .exit-button {
        background: linear-gradient(135deg, var(--accent-color), #ff8e53);
        color: var(--white);
        box-shadow: 0 6px 20px rgba(255, 107, 107, 0.3);
    }

    .exit-button:hover {
        transform: translateY(-5px) scale(1.05);
        box-shadow: 0 12px 30px rgba(255, 107, 107, 0.4);
    }

    .home-button {
        background: transparent;
        color: var(--text-secondary);
        border: 2px solid var(--text-secondary);
    }

    .home-button:hover {
        background: var(--text-secondary);
        color: var(--white);
        transform: translateY(-5px);
    }

    .accuracy-badge {
        display: inline-block;
        padding: 8px 20px;
        border-radius: 20px;
        font-weight: 700;
        font-size: 1.1rem;
        margin-top: 15px;
    }

    .high-accuracy {
        background: #d4edda;
        color: #155724;
    }

    .medium-accuracy {
        background: #fff3cd;
        color: #856404;
    }

    .low-accuracy {
        background: #f8d7da;
        color: #721c24;
    }

    .quote-box {
        margin: 40px auto;
        padding: 30px;
        background: linear-gradient(135deg, #ffe3e3 0%, #ffc9c9 100%);
        border-radius: 12px;
        font-style: italic;
        color: #c92a2a;
        font-size: 1.1rem;
        max-width: 500px;
        animation: fadeInUp 0.8s ease 0.4s both;
    }

    /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
    @keyframes fadeInDown {
        from {
            opacity: 0;
            transform: translateY(-30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @keyframes float {
        0%, 100% { transform: translateY(0) rotate(0deg); }
        33% { transform: translateY(-20px) rotate(5deg); }
        66% { transform: translateY(-10px) rotate(-5deg); }
    }

    @keyframes pulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.1); }
    }

    @keyframes countUp {
        from { transform: translateY(20px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
    }

    .count-up {
        animation: countUp 1s ease forwards;
    }

    @media (max-width: 768px) {
        .results-container {
            padding: 20px 15px;
        }

        .completion-title {
            font-size: 2.2rem;
        }

        .stats-grid {
            grid-template-columns: 1fr;
        }

        .buttons-container {
            flex-direction: column;
            align-items: center;
        }

        .action-button {
            width: 100%;
            max-width: 300px;
            justify-content: center;
        }

        .xp-value {
            font-size: 3rem;
        }
    }
</style>

<div class="results-container">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è -->
    <div class="completion-header">
        <div class="completion-icon">üéØ</div>
        <h1 class="completion-title">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–π–¥–µ–Ω–æ!</h1>
        <p class="completion-subtitle">
            –í—ã —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª–∏ —Å–µ—Ä–∏—é —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —Ä–µ–∂–∏–º–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        </p>
    </div>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
    <div class="stats-grid">
        <div class="stat-card">
            <span class="stat-icon">üìä</span>
            <div class="stat-value">{{ step }}</div>
            <div class="stat-label">–í—Å–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏–π</div>
            <div class="stat-description">–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –≤ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏</div>
        </div>

        <div class="stat-card">
            <span class="stat-icon">‚úÖ</span>
            <div class="stat-value">{{ correct_count }}</div>
            <div class="stat-label">–í–µ—Ä–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤</div>
            <div class="stat-description">
                {% set accuracy = (correct_count / step * 100) if step > 0 else 0 %}
                –¢–æ—á–Ω–æ—Å—Ç—å: {{ accuracy|round(1) }}%
            </div>
        </div>

        <div class="stat-card">
            <span class="stat-icon">‚ö°</span>
            <div class="stat-value">{{ (correct_count / step * 100)|round(1) if step > 0 else 0 }}%</div>
            <div class="stat-label">–û–±—â–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å</div>
            <div class="stat-description">
                {% set accuracy_percent = (correct_count / step * 100) if step > 0 else 0 %}
                {% if accuracy_percent >= 80 %}
                    <span class="accuracy-badge high-accuracy">–û—Ç–ª–∏—á–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç!</span>
                {% elif accuracy_percent >= 60 %}
                    <span class="accuracy-badge medium-accuracy">–•–æ—Ä–æ—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç</span>
                {% else %}
                    <span class="accuracy-badge low-accuracy">–ï—Å—Ç—å –Ω–∞–¥ —á–µ–º –ø–æ—Ä–∞–±–æ—Ç–∞—Ç—å</span>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- –ú–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω–∞—è —Ü–∏—Ç–∞—Ç–∞ -->
    <div class="quote-box">
        "–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Äî —ç—Ç–æ –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞—à–∏—Ö –Ω–∞–≤—ã–∫–æ–≤ –≤ —É—Å–ª–æ–≤–∏—è—Ö, –ø—Ä–∏–±–ª–∏–∂–µ–Ω–Ω—ã—Ö –∫ —Ä–µ–∞–ª—å–Ω—ã–º.
        –ö–∞–∂–¥—ã–π –ø—Ä–æ–π–¥–µ–Ω–Ω—ã–π —Ç–µ—Å—Ç –¥–µ–ª–∞–µ—Ç –≤–∞—Å –±–æ–ª–µ–µ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–º –∫ —Ü–∏—Ñ—Ä–æ–≤—ã–º –≤—ã–∑–æ–≤–∞–º."
    </div>

    <!-- –û–ø—ã—Ç -->
    <div class="xp-container">
        <div class="xp-header">
            <h2 class="xp-title">
                <span style="font-size: 1.5rem;">‚≠ê</span>
                –í–∞—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            </h2>
        </div>

        <div class="xp-value">{{ experience|int }} XP</div>
    </div>

    <!-- –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ -->
    <div class="performance-box">
        <h3 class="performance-title">
            <span style="font-size: 1.5rem;">üìà</span>
            –ê–Ω–∞–ª–∏–∑ –≤–∞—à–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
        </h3>
        <p class="performance-message">
            {% set accuracy = (correct_count / step * 100) if step > 0 else 0 %}
            {% if accuracy >= 80 %}
                –û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞! –í—ã –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç–µ –≤—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –ø–æ–Ω–∏–º–∞–Ω–∏—è –º–µ—Ç–æ–¥–æ–≤ –º–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–∞
                –≤ —É—Å–ª–æ–≤–∏—è—Ö —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è. –í–∞—à–∏ –Ω–∞–≤—ã–∫–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–º—É —É—Ä–æ–≤–Ω—é.
            {% elif accuracy >= 60 %}
                –•–æ—Ä–æ—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç! –í—ã —Ö–æ—Ä–æ—à–æ —Å–ø—Ä–∞–≤–ª—è–µ—Ç–µ—Å—å —Å –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ–º –º–æ—à–µ–Ω–Ω–∏—á–µ—Å–∫–∏—Ö —Å—Ö–µ–º.
                –î–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ —Ä–æ—Å—Ç–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –æ–±—Ä–∞—Ç–∏—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ —Å–ª–æ–∂–Ω—ã–µ —Å–ª—É—á–∞–∏.
            {% else %}
                –ï—Å—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è —Ä–æ—Å—Ç–∞! –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º –ø—Ä–æ–π—Ç–∏ –æ–±—É—á–∞—é—â—É—é —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É –∏ –∏–∑—É—á–∏—Ç—å –ø–∞–º—è—Ç–∫—É,
                —á—Ç–æ–±—ã –ª—É—á—à–µ –ø–æ–Ω–∏–º–∞—Ç—å –ø—Ä–∏–∑–Ω–∞–∫–∏ –º–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–∞.
            {% endif %}
        </p>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
    <div class="buttons-container">
        <form action="{{ url_for('test_room_preview') }}" method="get" style="display: inline;">
            <button type="submit" class="action-button exit-button">
                <span style="font-size: 1.4rem;">üö™</span>
                –í—ã–π—Ç–∏ –∏–∑ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            </button>
        </form>

        <a href="{{ url_for('index') }}" class="action-button home-button">
            <span style="font-size: 1.4rem;">üè†</span>
            –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é
        </a>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // –ê–Ω–∏–º–∞—Ü–∏—è —á–∏—Å–µ–ª
        const statValues = document.querySelectorAll('.stat-value');
        statValues.forEach(value => {
            const originalText = value.textContent;
            value.textContent = '0';
            value.classList.add('count-up');

            setTimeout(() => {
                value.textContent = originalText;
                value.style.animation = 'none';
            }, 100);
        });

        // –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞ XP
        const xpFill = document.querySelector('.xp-fill');
        if (xpFill) {
            const targetWidth = xpFill.style.width;
            xpFill.style.width = '0%';

            setTimeout(() => {
                xpFill.style.transition = 'width 1.5s ease';
                xpFill.style.width = targetWidth;
            }, 500);
        }

        // –ê–Ω–∏–º–∞—Ü–∏—è –∏–∫–æ–Ω–∫–∏
        const completionIcon = document.querySelector('.completion-icon');
        if (completionIcon) {
            completionIcon.style.opacity = '0';
            completionIcon.style.transform = 'scale(0) rotate(0deg)';

            setTimeout(() => {
                completionIcon.style.transition = 'opacity 1s ease, transform 1s ease';
                completionIcon.style.opacity = '1';
                completionIcon.style.transform = 'scale(1) rotate(360deg)';
            }, 300);
        }

        // –ü–ª–∞–≤–Ω–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–µ–∫
        const statCards = document.querySelectorAll('.stat-card');
        statCards.forEach((card, index) => {
            card.style.opacity = '0';
            card.style.transform = 'translateY(50px)';

            setTimeout(() => {
                card.style.transition = 'opacity 0.8s ease, transform 0.8s ease';
                card.style.opacity = '1';
                card.style.transform = 'translateY(0)';
            }, 300 + (index * 200));
        });

        // –≠—Ñ—Ñ–µ–∫—Ç –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –Ω–∞ –∫–Ω–æ–ø–∫–∏
        const actionButtons = document.querySelectorAll('.action-button');
        actionButtons.forEach(button => {
            button.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-8px)';
            });

            button.addEventListener('mouseleave', function() {
                this.style.transform = 'translateY(0)';
            });
        });

        // –ü—É–ª—å—Å–∞—Ü–∏—è –∫–Ω–æ–ø–∫–∏ –≤—ã—Ö–æ–¥–∞
        const exitButton = document.querySelector('.exit-button');
        if (exitButton) {
            exitButton.classList.add('pulse');
        }
    });
    // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–ø—Ä–æ—Å—Ç–æ–π –≤–∞—Ä–∏–∞–Ω—Ç)
    window.addEventListener('beforeunload', function (e) {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –Ω–∞–∂–∞—Ç–∞ –ª–∏ –∫–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞
        const exitButtonClicked = sessionStorage.getItem('exitClicked');

        if (!exitButtonClicked) {
            e.preventDefault();
            e.returnValue = '–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –±—É–¥—É—Ç –ø–æ—Ç–µ—Ä—è–Ω—ã. –í—ã —É–≤–µ—Ä–µ–Ω—ã?';
        }
    });

    // –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏ –≤—ã—Ö–æ–¥–∞ —Ä–∞–∑—Ä–µ—à–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
    document.querySelector('.exit-button')?.addEventListener('click', function() {
        sessionStorage.setItem('exitClicked', 'true');
    });

    // –û—á–∏—â–∞–µ–º —Ñ–ª–∞–≥ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    window.addEventListener('load', function() {
        sessionStorage.removeItem('exitClicked');
    });
</script>

{% endblock %}
{% set show_footer = False %}