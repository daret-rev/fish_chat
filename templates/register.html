{% extends 'base.html' %}
{% block title %}–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è{% endblock %}

{% block content %}
<style>
    .auth-container {
        max-width: 480px;
        margin: 80px auto;
        padding: 50px 40px;
        background: var(--white);
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
        border-top: 6px solid var(--secondary-color);
        text-align: center;
    }

    .auth-header {
        margin-bottom: 40px;
    }

    .auth-icon {
        font-size: 4rem;
        color: var(--secondary-color);
        margin-bottom: 20px;
        animation: float 3s ease-in-out infinite;
    }

    .auth-title {
        font-size: 2.2rem;
        font-weight: 800;
        color: var(--text-primary);
        margin-bottom: 10px;
        background: linear-gradient(135deg, var(--secondary-color), #1aa179);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .auth-subtitle {
        font-size: 1.1rem;
        color: var(--text-secondary);
        line-height: 1.6;
    }

    .auth-form {
        text-align: left;
    }

    .form-group {
        margin-bottom: 25px;
    }

    .form-label {
        display: block;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 10px;
        font-size: 1rem;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .form-input {
        width: 100%;
        padding: 16px 20px;
        border: 2px solid #e1e5eb;
        border-radius: 10px;
        font-size: 1rem;
        color: var(--text-primary);
        background: var(--white);
        transition: all 0.3s ease;
        box-sizing: border-box;
    }

    .form-input:focus {
        outline: none;
        border-color: var(--secondary-color);
        box-shadow: 0 0 0 4px rgba(32, 201, 151, 0.1);
    }

    .form-input::placeholder {
        color: #adb5bd;
    }

    .form-input.has-error {
        border-color: #dc3545;
        background: #fff5f5;
    }

    .error-message {
        color: #dc3545;
        font-size: 0.9rem;
        margin-top: 8px;
        display: flex;
        align-items: center;
        gap: 8px;
        animation: fadeIn 0.3s ease;
    }

    .success-message {
        color: #28a745;
        font-size: 0.9rem;
        margin-top: 8px;
        display: flex;
        align-items: center;
        gap: 8px;
        animation: fadeIn 0.3s ease;
    }

    .auth-button {
        width: 100%;
        padding: 18px;
        background: linear-gradient(135deg, var(--secondary-color), #1aa179);
        color: var(--white);
        border: none;
        border-radius: 10px;
        font-size: 1.1rem;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
        margin-top: 10px;
        box-shadow: 0 4px 15px rgba(32, 201, 151, 0.3);
    }

    .auth-button:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(32, 201, 151, 0.4);
    }

    .auth-button:disabled {
        opacity: 0.7;
        cursor: not-allowed;
        transform: none;
    }

    .auth-button:active {
        transform: translateY(-1px);
    }

    .auth-links {
        margin-top: 30px;
        text-align: center;
        padding-top: 25px;
        border-top: 1px solid #e9ecef;
    }

    .auth-link {
        color: var(--secondary-color);
        text-decoration: none;
        font-weight: 600;
        font-size: 1rem;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 10px 20px;
        border-radius: 8px;
    }

    .auth-link:hover {
        background: rgba(32, 201, 151, 0.1);
        transform: translateY(-2px);
    }

    .home-link {
        margin-top: 20px;
        display: inline-block;
        color: var(--text-secondary);
        text-decoration: none;
        font-weight: 500;
        transition: all 0.3s ease;
        padding: 10px 20px;
        border-radius: 8px;
    }

    .home-link:hover {
        color: var(--secondary-color);
        background: rgba(32, 201, 151, 0.05);
    }

    .password-hint {
        font-size: 0.85rem;
        color: var(--text-secondary);
        margin-top: 8px;
        padding: 10px;
        background: #f8f9fa;
        border-radius: 6px;
        border-left: 3px solid var(--secondary-color);
    }

    @keyframes float {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-10px); }
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(-10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    @media (max-width: 576px) {
        .auth-container {
            margin: 40px 20px;
            padding: 40px 25px;
        }

        .auth-title {
            font-size: 1.8rem;
        }

        .auth-icon {
            font-size: 3rem;
        }
    }
</style>

<div class="auth-container">
    <div class="auth-header">
        <div class="auth-icon">üìù</div>
        <h1 class="auth-title">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h1>
        <p class="auth-subtitle">
            –°–æ–∑–¥–∞–π—Ç–µ –∞–∫–∫–∞—É–Ω—Ç –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–∏—Å—Ç–µ–º–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        </p>
    </div>

    <form class="auth-form" method="POST" action="{{ url_for('register') }}" id="registerForm">
        <div class="form-group">
            <label class="form-label">
                <span style="font-size: 1.1rem;">üë§</span>
                –õ–æ–≥–∏–Ω
            </label>
            <input type="text"
                   name="username"
                   class="form-input"
                   placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ª–æ–≥–∏–Ω"
                   required
                   minlength="3"
                   maxlength="30">
            <div class="password-hint">
                –û—Ç 3 –¥–æ 30 —Å–∏–º–≤–æ–ª–æ–≤. –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã –∏ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏–µ.
            </div>
        </div>

        <div class="form-group">
            <label class="form-label">
                <span style="font-size: 1.1rem;">üîí</span>
                –ü–∞—Ä–æ–ª—å
            </label>
            <input type="password"
                   name="password"
                   class="form-input"
                   placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å"
                   required
                   minlength="4">
            <div class="password-hint">
                –ú–∏–Ω–∏–º—É–º 4 —Å–∏–º–≤–æ–ª–∞. –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–ª–æ–∂–Ω—ã–π –ø–∞—Ä–æ–ª—å.
            </div>
        </div>

        <div id="errorContainer" class="error-message" style="display: none;"></div>
        <div id="successContainer" class="success-message" style="display: none;"></div>

        <button type="submit" class="auth-button" id="submitBtn">
            <span style="font-size: 1.2rem;">üöÄ</span>
            –°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç
        </button>
    </form>

    <div class="auth-links">
        <a href="{{ url_for('login') }}" class="auth-link">
            <span style="font-size: 1.1rem;">üîê</span>
            –£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? –í–æ–π—Ç–∏
        </a>
        <br>
        <a href="{{ url_for('index') }}" class="home-link">
            <span style="font-size: 1.1rem;">üè†</span>
            –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é
        </a>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('registerForm');
        const submitBtn = document.getElementById('submitBtn');
        const errorContainer = document.getElementById('errorContainer');
        const successContainer = document.getElementById('successContainer');
        const inputs = form.querySelectorAll('.form-input');

        // –§–æ–∫—É—Å –Ω–∞ –ø–µ—Ä–≤–æ–º –ø–æ–ª–µ
        inputs[0]?.focus();

        // –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ –≤–≤–æ–¥–µ
        inputs.forEach(input => {
            input.addEventListener('input', function() {
                this.classList.remove('has-error');
                errorContainer.style.display = 'none';
                errorContainer.textContent = '';
            });
        });

        // –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã
        form.addEventListener('submit', async function(e) {
            e.preventDefault();

            // –ë–∞–∑–æ–≤–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
            let isValid = true;
            const username = inputs[0].value.trim();
            const password = inputs[1].value.trim();

            if (username.length < 3 || username.length > 30) {
                inputs[0].classList.add('has-error');
                showError('–õ–æ–≥–∏–Ω –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 3 –¥–æ 30 —Å–∏–º–≤–æ–ª–æ–≤');
                isValid = false;
            }

            if (password.length < 4) {
                inputs[1].classList.add('has-error');
                showError('–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 4 —Å–∏–º–≤–æ–ª–æ–≤');
                isValid = false;
            }

            if (!username || !password) {
                showError('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
                isValid = false;
            }

            if (!isValid) return;

            // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<span style="font-size: 1.2rem;">‚è≥</span> –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è...';
            submitBtn.disabled = true;

            try {
                const formData = new FormData(this);
                const response = await fetch(this.action, {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                });

                // –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å JSON
                const contentType = response.headers.get('content-type');
                if (contentType && contentType.includes('application/json')) {
                    const data = await response.json();

                    if (data.success) {
                        // –£—Å–ø–µ—à–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è - —Ä–µ–¥–∏—Ä–µ–∫—Ç
                        window.location.href = data.redirect || '{{ url_for("index") }}';
                    } else {
                        // –û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
                        showError(data.message || '–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏');
                        submitBtn.innerHTML = originalText;
                        submitBtn.disabled = false;
                    }
                } else {
                    // –ï—Å–ª–∏ –æ—Ç–≤–µ—Ç –Ω–µ JSON, –≤–µ—Ä–æ—è—Ç–Ω–æ —ç—Ç–æ —Ä–µ–¥–∏—Ä–µ–∫—Ç
                    window.location.href = '{{ url_for("index") }}';
                }
            } catch (error) {
                // –û—à–∏–±–∫–∞ —Å–µ—Ç–∏
                showError('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        });

        function showError(message) {
            errorContainer.innerHTML = `
                <span style="font-size: 1.1rem;">‚ö†Ô∏è</span>
                ${message}
            `;
            errorContainer.style.display = 'flex';
            successContainer.style.display = 'none';

            // –ê–≤—Ç–æ—Å–∫—Ä—ã—Ç–∏–µ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            setTimeout(() => {
                errorContainer.style.display = 'none';
            }, 5000);
        }

        function showSuccess(message) {
            successContainer.innerHTML = `
                <span style="font-size: 1.1rem;">‚úÖ</span>
                ${message}
            `;
            successContainer.style.display = 'flex';
            errorContainer.style.display = 'none';
        }

        // –ê–Ω–∏–º–∞—Ü–∏—è –∏–∫–æ–Ω–∫–∏
        const authIcon = document.querySelector('.auth-icon');
        authIcon.style.opacity = '0';
        authIcon.style.transform = 'scale(0) rotate(0deg)';

        setTimeout(() => {
            authIcon.style.transition = 'opacity 1s ease, transform 1s ease';
            authIcon.style.opacity = '1';
            authIcon.style.transform = 'scale(1) rotate(360deg)';
        }, 300);
    });
</script>

{% endblock %}

{% set show_footer = False %}