{% extends 'base.html' %}
{% block title %}Тренировка – Шаг {{ step + 1 }}{% endblock %}

{% block content %}
<h2>Шаг {{ step + 1 }} из {{ total }}</h2>

<div class="chat-box">
  <div class="message"><strong>Сообщение:</strong> {{ message.text }}</div>
</div>

<p><strong>Опыт:</strong> {{ experience }}
  {% if exp_change %}
    <span class="{{ 'exp-positive' if exp_change > 0 else 'exp-negative' }}">
      {% if exp_change > 0 %}+{% endif %}{{ exp_change }}
    </span>
  {% endif %}
</p>

{% if state == 'question' %}
  <!-- Состояние 1: Выбор ответа -->
  <form method="post">
    <p>Как вы считаете, это мошенники или нет?</p>
    <button type="submit" name="answer" value="yes">Да</button>
    <button type="submit" name="answer" value="no">Нет</button>
    <button type="submit" name="answer" value="finish">Завершить тренировку</button>
  </form>
  
{% else %}
  <!-- Состояние 2: Показ результата и комментария -->
  <div class="answer-result">
    <p>Ваш ответ: <strong>{{ 'Да' if current_answer == 'yes' else 'Нет' }}</strong></p>
    <p class="{{ 'correct' if is_correct else 'incorrect' }}">
      {{ 'Правильно!' if is_correct else 'Неправильно!' }}
    </p>
    
    {% if explanation %}
      <div class="explanation-box">
        <p><em>{{ explanation }}</em></p>
      </div>
    {% endif %}
  </div>
  
  <!-- Форма для навигации -->
  <form method="post">
    {% if step < total - 1 %}
      <button type="submit" name="action" value="next">Далее →</button>
    {% else %}
      <p>Это был последний вопрос!</p>
      <button type="submit" name="action" value="finish">Завершить тренировку</button>
    {% endif %}
  </form>
{% endif %}
{% endblock %}

{% set show_footer = False %}
