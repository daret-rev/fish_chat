{% extends 'base.html' %}
{% block title %}–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≥—Ä—É–ø–ø—ã - {{ group.groupname }} | {{ test.name }}{% endblock %}

{% block content %}

<style>
    .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
    }

    .back-btn {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 12px 24px;
        background: #f8f9fa;
        color: #495057;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        text-decoration: none;
        font-weight: 600;
        font-size: 1rem;
        transition: all 0.3s ease;
        margin-bottom: 30px;
    }

    .back-btn:hover {
        background: #e9ecef;
        transform: translateX(-5px);
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .group-header {
        background: white;
        border-radius: 12px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        border-left: 4px solid #6f42c1;
    }

    .header-title {
        margin: 0 0 25px 0;
        color: #2c3e50;
        font-size: 1.8rem;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 25px;
    }

    .stat-card {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 20px;
        border: 1px solid #e9ecef;
        transition: all 0.3s ease;
    }

    .stat-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .stat-label {
        font-size: 0.9rem;
        color: #6c757d;
        margin-bottom: 8px;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .stat-value {
        font-size: 1.5rem;
        font-weight: 700;
        color: #2c3e50;
    }

    .score-badge {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 8px 16px;
        border-radius: 20px;
        font-weight: 700;
        font-size: 1.2rem;
        min-width: 80px;
        justify-content: center;
    }

    .score-good {
        background: #d4edda;
        color: #155724;
    }

    .score-medium {
        background: #fff3cd;
        color: #856404;
    }

    .score-poor {
        background: #f8d7da;
        color: #721c24;
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∂–∏–º–æ–≤ */
    .mode-switcher {
        display: flex;
        background: #f8f9fa;
        border-radius: 10px;
        padding: 5px;
        margin-bottom: 25px;
        width: fit-content;
        border: 1px solid #dee2e6;
    }

    .mode-btn {
        padding: 12px 30px;
        border: none;
        background: none;
        border-radius: 8px;
        font-weight: 600;
        color: #6c757d;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .mode-btn.active {
        background: white;
        color: #6f42c1;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .mode-btn:hover:not(.active) {
        background: #e9ecef;
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ */
    .participants-table {
        background: white;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        margin-bottom: 40px;
    }

    .table-header {
        background: #f8f9fa;
        padding: 20px;
        border-bottom: 1px solid #e9ecef;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    .table-title {
        font-size: 1.2rem;
        font-weight: 600;
        color: #495057;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .data-table {
        width: 100%;
        border-collapse: collapse;
    }

    .data-table th {
        background: linear-gradient(135deg, #6f42c1 0%, #5a32a3 100%);
        color: white;
        font-weight: 600;
        padding: 16px;
        text-align: left;
        position: sticky;
        top: 0;
    }

    .data-table td {
        padding: 16px;
        border-bottom: 1px solid #e9ecef;
        vertical-align: middle;
    }

    .data-table tbody tr:hover {
        background-color: #f8f9fa;
    }

    .user-score {
        display: inline-block;
        padding: 6px 12px;
        border-radius: 20px;
        font-weight: 700;
        font-size: 0.95rem;
        min-width: 60px;
        text-align: center;
    }

    .user-score.good {
        background: #d4edda;
        color: #155724;
    }

    .user-score.medium {
        background: #fff3cd;
        color: #856404;
    }

    .user-score.poor {
        background: #f8d7da;
        color: #721c24;
    }

    .progress-container {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .progress-value {
        font-weight: 600;
        color: #495057;
        min-width: 50px;
    }

    .progress-bar {
        flex: 1;
        height: 8px;
        background: #e9ecef;
        border-radius: 4px;
        overflow: hidden;
    }

    .progress-fill {
        height: 100%;
        border-radius: 4px;
        transition: width 0.3s ease;
    }

    .progress-fill.high {
        background: linear-gradient(90deg, #28a745 0%, #20c997 100%);
    }

    .progress-fill.medium {
        background: linear-gradient(90deg, #ffc107 0%, #fd7e14 100%);
    }

    .progress-fill.low {
        background: linear-gradient(90deg, #dc3545 0%, #c82333 100%);
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–µ–∫—Ü–∏–∏ –æ—à–∏–±–æ–∫ */
    .errors-section {
        margin-top: 40px;
    }

    .section-title {
        margin: 40px 0 20px 0;
        color: #495057;
        font-size: 1.4rem;
        display: flex;
        align-items: center;
        gap: 10px;
        padding-bottom: 10px;
        border-bottom: 2px solid #f1f3f5;
    }

    .error-stat {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 6px 16px;
        background: #f8f9fa;
        border-radius: 20px;
        font-weight: 600;
        font-size: 0.9rem;
        color: #495057;
        margin-left: 10px;
    }

    .error-stat.common {
        background: #dc3545;
        color: white;
    }

    .error-stat.individual {
        background: #17a2b8;
        color: white;
    }

    .errors-container {
        background: white;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        margin-bottom: 40px;
    }

    .errors-header {
        background: #f8f9fa;
        padding: 20px;
        border-bottom: 1px solid #e9ecef;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    .questions-count {
        font-size: 1rem;
        color: #6c757d;
    }

    .message-card {
        padding: 25px;
        border-bottom: 1px solid #e9ecef;
        transition: all 0.3s ease;
    }

    .message-card:hover {
        background-color: #f8f9fa;
    }

    .message-id {
        background: #6f42c1;
        color: white;
        padding: 8px 16px;
        border-radius: 6px;
        font-weight: 600;
        font-size: 0.9rem;
        display: inline-block;
        margin-bottom: 20px;
    }

    .message-text {
        font-size: 1.1rem;
        line-height: 1.6;
        color: #2c3e50;
        margin-bottom: 25px;
        padding: 20px;
        background: #f8f9fa;
        border-radius: 8px;
        border-left: 4px solid #6f42c1;
    }

    .answer-section {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 25px;
    }

    @media (max-width: 768px) {
        .answer-section {
            grid-template-columns: 1fr;
        }
    }

    .answer-card {
        padding: 20px;
        border-radius: 8px;
        border: 2px solid transparent;
    }

    .answer-card.correct {
        border-color: #28a745;
        background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
    }

    .answer-card.incorrect {
        border-color: #dc3545;
        background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
    }

    .answer-label {
        font-weight: 700;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .answer-label.correct {
        color: #155724;
    }

    .answer-label.incorrect {
        color: #721c24;
    }

    .answer-value {
        font-size: 1.1rem;
        font-weight: 600;
        margin-bottom: 15px;
        padding: 10px;
        background: white;
        border-radius: 6px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    .comment-section {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 8px;
        border-left: 4px solid #17a2b8;
        margin-top: 20px;
    }

    .comment-title {
        font-weight: 600;
        color: #495057;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .comment-text {
        color: #6c757d;
        line-height: 1.6;
        font-size: 0.95rem;
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –æ—à–∏–±–∫–∞–º–∏ */
    .error-users {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
        margin-top: 15px;
    }

    .error-users-title {
        font-weight: 600;
        color: #495057;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 0.9rem;
    }

    .error-users-list {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
    }

    .error-user-badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        background: white;
        color: #495057;
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 600;
        border: 1px solid #e9ecef;
        transition: all 0.3s ease;
        text-decoration: none;
    }

    .error-user-badge:hover {
        background: #6f42c1;
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(111,66,193,0.3);
    }

    .no-data {
        text-align: center;
        padding: 60px 20px;
        color: #6c757d;
    }

    .no-data-icon {
        font-size: 3rem;
        margin-bottom: 15px;
        opacity: 0.5;
    }

    .view-details-btn {
        display: inline-flex;
        align-items: center;
        gap: 5px;
        background: #6f42c1;
        color: white;
        padding: 6px 12px;
        border-radius: 6px;
        font-size: 0.85rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        border: none;
        text-decoration: none;
    }

    .view-details-btn:hover {
        background: #5a32a3;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(111,66,193,0.3);
    }

    /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
    @media (max-width: 768px) {
        .mode-switcher {
            width: 100%;
            justify-content: center;
        }

        .mode-btn {
            flex: 1;
            justify-content: center;
            padding: 12px 15px;
            font-size: 0.9rem;
        }

        .stats-grid {
            grid-template-columns: 1fr;
        }

        .data-table {
            font-size: 0.9rem;
        }

        .data-table th,
        .data-table td {
            padding: 12px 10px;
        }
    }
</style>

<div class="container">
    <!-- –ö–Ω–æ–ø–∫–∞ –Ω–∞–∑–∞–¥ -->
    <a href="{{ url_for('results_detailed', testing_id=test.id) }}" class="back-btn">
        <span style="font-size: 1.2rem;">‚Üê</span>
        –ù–∞–∑–∞–¥ –∫ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ —Ç–µ—Å—Ç–∞
    </a>

    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
    <div class="group-header">
        <h1 class="header-title">
            <span style="font-size: 1.5rem;">üè¢</span>
            –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≥—Ä—É–ø–ø—ã: {{ group.groupname }}
        </h1>
        <p style="color: #6c757d; margin: 0;">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: {{ test.name }}</p>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">
                    <span style="font-size: 1.1rem;">üë•</span>
                    –£—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≤ –≥—Ä—É–ø–ø–µ
                </div>
                <div class="stat-value">{{ group_stats.total_users }}</div>
            </div>

            <div class="stat-card">
                <div class="stat-label">
                    <span style="font-size: 1.1rem;">üìù</span>
                    –ü—Ä–æ—à–ª–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
                </div>
                <div class="stat-value">{{ group_stats.completed_users }}</div>
            </div>

            <div class="stat-card">
                <div class="stat-label">
                    <span style="font-size: 1.1rem;">‚≠ê</span>
                    –°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª
                </div>
                <div class="stat-value">
                    <span class="score-badge
                        {% if group_stats.avg_score >= 80 %}score-good
                        {% elif group_stats.avg_score >= 60 %}score-medium
                        {% else %}score-poor{% endif %}">
                        {{ "%.1f"|format(group_stats.avg_score) }}
                    </span>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-label">
                    <span style="font-size: 1.1rem;">üéØ</span>
                    –û–±—â–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å
                </div>
                <div class="stat-value">{{ "%.1f"|format(group_stats.accuracy) }}%</div>
            </div>
        </div>
    </div>
    <!-- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤ –æ—à–∏–±–æ–∫ -->
    <div class="mode-switcher">
        <button class="mode-btn active" id="commonErrorsBtn">
            <span style="font-size: 1.1rem;">‚ö†Ô∏è</span>
            –û–±—â–∏–µ –æ—à–∏–±–∫–∏
            {% if common_errors_count %}
            <span class="error-stat common">{{ common_errors_count }}</span>
            {% endif %}
        </button>
        <button class="mode-btn" id="individualErrorsBtn">
            <span style="font-size: 1.1rem;">üë§</span>
            –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏
            {% if individual_errors_count %}
            <span class="error-stat individual">{{ individual_errors_count }}</span>
            {% endif %}
        </button>
    </div>

    <!-- –°–µ–∫—Ü–∏—è –æ–±—â–∏—Ö –æ—à–∏–±–æ–∫ -->
    <div id="commonErrorsSection">
        <h3 class="section-title">
            <span style="font-size: 1.3rem;">‚ö†Ô∏è</span>
            –û–±—â–∏–µ –æ—à–∏–±–∫–∏ –≥—Ä—É–ø–ø—ã
            {% if common_errors_count %}
            <span class="error-stat common">–û—à–∏–±–ª–∏—Å—å: {{ common_errors_count }} –≤–æ–ø—Ä–æ—Å–æ–≤</span>
            {% endif %}
        </h3>

        {% if common_errors %}
        <div class="errors-container">
            <div class="errors-header">
                <div>
                    <span style="font-weight: 600; color: #495057;">–í–æ–ø—Ä–æ—Å—ã, –≤ –∫–æ—Ç–æ—Ä—ã—Ö –æ—à–∏–±–ª–∏—Å—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</span>
                    <div class="questions-count">–í—Å–µ–≥–æ –≤–æ–ø—Ä–æ—Å–æ–≤: {{ total_questions_count }}</div>
                </div>
                <div style="text-align: right;">
                    <div style="font-size: 0.9rem; color: #6c757d;">–û—à–∏–±–æ–∫ —É >1 —É—á–∞—Å—Ç–Ω–∏–∫–∞</div>
                    <div style="font-size: 1.2rem; font-weight: 700; color: #dc3545;">{{ common_errors_count }}</div>
                </div>
            </div>

            {% for error in common_errors %}
            <div class="message-card">
                <div class="message-id">–í–æ–ø—Ä–æ—Å #{{ error.id }}</div>

                <div class="message-text">
                    {{ error.text }}
                </div>

                <div class="answer-section">
                    <div class="answer-card correct">
                        <div class="answer-label correct">
                            <span style="font-size: 1.1rem;">‚úÖ</span>
                            –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
                        </div>
                        <div class="answer-value">
                            {% if error.correct %}
                                <span style="color: #28a745;">–î–∞</span>
                            {% else %}
                                <span style="color: #28a745;">–ù–µ—Ç</span>
                            {% endif %}
                        </div>
                    </div>

                    <div class="answer-card incorrect">
                        <div class="answer-label incorrect">
                            <span style="font-size: 1.1rem;">‚ùå</span>
                            –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
                        </div>
                        <div class="answer-value">
                            {% if error.correct %}
                                <span style="color: #dc3545;">–ù–µ—Ç</span>
                            {% else %}
                                <span style="color: #dc3545;">–î–∞</span>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <div class="error-users">
                    <div class="error-users-title">
                        <span style="font-size: 1rem;">üë•</span>
                        –û—à–∏–±–ª–∏—Å—å —É—á–∞—Å—Ç–Ω–∏–∫–∏ ({{ error.error_count }}):
                    </div>
                    <div class="error-users-list">
                        {% for user in error.users %}
                        <a href="{{ url_for('user_results', testing_id=test.id, user_id=user.id) }}"
                           class="error-user-badge">
                            <span>{{ user.username }}</span>
                        </a>
                        {% endfor %}
                    </div>
                </div>

                <div class="comment-section">
                    <div class="comment-title">
                        <span style="font-size: 1.1rem;">üí°</span>
                        –û–±—ä—è—Å–Ω–µ–Ω–∏–µ –æ—à–∏–±–∫–∏
                    </div>
                    <div class="comment-text">
                        {% if error.correct %}
                            {{ error.comment_no or '–ù–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è –¥–ª—è —ç—Ç–æ–≥–æ –æ—Ç–≤–µ—Ç–∞' }}
                        {% else %}
                            {{ error.comment_yes or '–ù–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è –¥–ª—è —ç—Ç–æ–≥–æ –æ—Ç–≤–µ—Ç–∞' }}
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="no-data">
            <div class="no-data-icon">üéâ</div>
            <h3 style="margin-bottom: 10px; color: #495057;">–ù–µ—Ç –æ–±—â–∏—Ö –æ—à–∏–±–æ–∫!</h3>
            <p style="margin-bottom: 20px; color: #6c757d; max-width: 500px; margin-left: auto; margin-right: auto;">
                –í —ç—Ç–æ–π –≥—Ä—É–ø–ø–µ –Ω–µ—Ç –≤–æ–ø—Ä–æ—Å–æ–≤, –≤ –∫–æ—Ç–æ—Ä—ã—Ö –æ—à–∏–±–ª–∏—Å—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤.
            </p>
            <div style="
                display: inline-flex;
                align-items: center;
                gap: 10px;
                padding: 12px 24px;
                background: #d4edda;
                color: #155724;
                border-radius: 8px;
                font-weight: 600;
                font-size: 1.1rem;
            ">
                <span style="font-size: 1.3rem;">‚úÖ</span>
                –•–æ—Ä–æ—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≥—Ä—É–ø–ø—ã
            </div>
        </div>
        {% endif %}
    </div>

    <!-- –°–µ–∫—Ü–∏—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã—Ö –æ—à–∏–±–æ–∫ -->
    <div id="individualErrorsSection" style="display: none;">
        <h3 class="section-title">
            <span style="font-size: 1.3rem;">üë§</span>
            –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏
            {% if individual_errors_count %}
            <span class="error-stat individual">–û—à–∏–±–æ–∫: {{ individual_errors_count }} –≤–æ–ø—Ä–æ—Å–æ–≤</span>
            {% endif %}
        </h3>

        {% if individual_errors %}
        <div class="errors-container">
            <div class="errors-header">
                <div>
                    <span style="font-weight: 600; color: #495057;">–í–æ–ø—Ä–æ—Å—ã, –≤ –∫–æ—Ç–æ—Ä—ã—Ö –æ—à–∏–±—Å—è –æ–¥–∏–Ω —É—á–∞—Å—Ç–Ω–∏–∫</span>
                    <div class="questions-count">–í—Å–µ–≥–æ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã—Ö –æ—à–∏–±–æ–∫: {{ individual_errors_count }}</div>
                </div>
                <div style="text-align: right;">
                    <div style="font-size: 0.9rem; color: #6c757d;">–£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏</div>
                    <div style="font-size: 1.2rem; font-weight: 700; color: #17a2b8;">{{ individual_errors_count }}</div>
                </div>
            </div>

            {% for error_item in individual_errors %}
            <div class="message-card">
                <div class="message-id">–í–æ–ø—Ä–æ—Å #{{ error_item.message.id }}</div>

                <div class="message-text">
                    {{ error_item.message.text }}
                </div>

                <div class="answer-section">
                    <div class="answer-card correct">
                        <div class="answer-label correct">
                            <span style="font-size: 1.1rem;">‚úÖ</span>
                            –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
                        </div>
                        <div class="answer-value">
                            {% if error_item.message.correct %}
                                <span style="color: #28a745;">–î–∞</span>
                            {% else %}
                                <span style="color: #28a745;">–ù–µ—Ç</span>
                            {% endif %}
                        </div>
                    </div>

                    <div class="answer-card incorrect">
                        <div class="answer-label incorrect">
                            <span style="font-size: 1.1rem;">‚ùå</span>
                            –û—Ç–≤–µ—Ç —É—á–∞—Å—Ç–Ω–∏–∫–∞
                        </div>
                        <div class="answer-value">
                            {% if error_item.message.correct %}
                                <span style="color: #dc3545;">–ù–µ—Ç</span>
                            {% else %}
                                <span style="color: #dc3545;">–î–∞</span>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <div class="error-users">
                    <div class="error-users-title">
                        <span style="font-size: 1rem;">üë§</span>
                        –£—á–∞—Å—Ç–Ω–∏–∫ —Å –æ—à–∏–±–∫–æ–π:
                    </div>
                    <div class="error-users-list">
                        <a href="{{ url_for('user_results', testing_id=test.id, user_id=error_item.user.id) }}"
                           class="error-user-badge">
                            <span>{{ error_item.user.username }}</span>
                            <small>(ID: {{ error_item.user.id }})</small>
                        </a>
                    </div>
                </div>

                <div class="comment-section">
                    <div class="comment-title">
                        <span style="font-size: 1.1rem;">üí°</span>
                        –û–±—ä—è—Å–Ω–µ–Ω–∏–µ –æ—à–∏–±–∫–∏
                    </div>
                    <div class="comment-text">
                        {% if error_item.message.correct %}
                            {{ error_item.message.comment_no or '–ù–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è –¥–ª—è —ç—Ç–æ–≥–æ –æ—Ç–≤–µ—Ç–∞' }}
                        {% else %}
                            {{ error_item.message.comment_yes or '–ù–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è –¥–ª—è —ç—Ç–æ–≥–æ –æ—Ç–≤–µ—Ç–∞' }}
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="no-data">
            <div class="no-data-icon">‚úÖ</div>
            <h3 style="margin-bottom: 10px; color: #495057;">–ù–µ—Ç –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã—Ö –æ—à–∏–±–æ–∫!</h3>
            <p style="margin-bottom: 20px; color: #6c757d; max-width: 500px; margin-left: auto; margin-right: auto;">
                –í—Å–µ –æ—à–∏–±–∫–∏ –≤ —ç—Ç–æ–π –≥—Ä—É–ø–ø–µ —è–≤–ª—è—é—Ç—Å—è –æ–±—â–∏–º–∏ –¥–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤.
            </p>
        </div>
        {% endif %}
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤ –æ—à–∏–±–æ–∫
        const commonErrorsBtn = document.getElementById('commonErrorsBtn');
        const individualErrorsBtn = document.getElementById('individualErrorsBtn');
        const commonErrorsSection = document.getElementById('commonErrorsSection');
        const individualErrorsSection = document.getElementById('individualErrorsSection');

        function switchErrorsMode(mode) {
            if (mode === 'common') {
                commonErrorsBtn.classList.add('active');
                individualErrorsBtn.classList.remove('active');
                commonErrorsSection.style.display = 'block';
                individualErrorsSection.style.display = 'none';
            } else {
                commonErrorsBtn.classList.remove('active');
                individualErrorsBtn.classList.add('active');
                commonErrorsSection.style.display = 'none';
                individualErrorsSection.style.display = 'block';
            }
        }

        commonErrorsBtn.addEventListener('click', () => switchErrorsMode('common'));
        individualErrorsBtn.addEventListener('click', () => switchErrorsMode('individual'));

        // –ü–ª–∞–≤–Ω–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–µ–∫
        const messageCards = document.querySelectorAll('.message-card');
        messageCards.forEach((card, index) => {
            card.style.opacity = '0';
            card.style.transform = 'translateY(20px)';

            setTimeout(() => {
                card.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
                card.style.opacity = '1';
                card.style.transform = 'translateY(0)';
            }, index * 100);
        });

        // –ü–ª–∞–≤–Ω–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏—Ö –∫–∞—Ä—Ç–æ—á–µ–∫
        const statCards = document.querySelectorAll('.stat-card');
        statCards.forEach((card, index) => {
            card.style.opacity = '0';
            card.style.transform = 'scale(0.9)';

            setTimeout(() => {
                card.style.transition = 'opacity 0.4s ease, transform 0.4s ease';
                card.style.opacity = '1';
                card.style.transform = 'scale(1)';
            }, index * 150);
        });

        // –ü–ª–∞–≤–Ω–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫ —Ç–∞–±–ª–∏—Ü—ã
        const tableRows = document.querySelectorAll('.data-table tbody tr');
        tableRows.forEach((row, index) => {
            row.style.opacity = '0';
            row.style.transform = 'translateX(-20px)';

            setTimeout(() => {
                row.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
                row.style.opacity = '1';
                row.style.transform = 'translateX(0)';
            }, index * 50);
        });
    });
</script>
{% endblock %}
{% set show_footer = False %}