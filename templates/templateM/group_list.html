{% extends 'base.html' %}
{% block title %}Админ – Список групп{% endblock %}
{% block content %}

<p><a href="{{ url_for('testing_management') }}" class="btn">← назад</a></p>
<h2>Список всех групп</h2>

<!-- Фильтр поиска -->
<div style="margin: 20px 0;">
  <input type="text" id="searchName" placeholder="Поиск по названию..."
         style="padding: 8px; width: 300px;">

  <input type="text" id="searchID" placeholder="Поиск по ID..."
         style="padding: 8px; width: 100px; margin-left: 10px;">

  <button type="button" onclick="searchTable()" style="padding: 6px 16px; margin-left: 15px;">
    Найти
  </button>

  <button type="button" onclick="clearSearch()" style="padding: 6px 16px; margin-left: 10px;">
    Сбросить
  </button>
</div>

<table border="1" cellpadding="5" id="groupTable">
  <tr>
    <th>ID</th><th>Название</th><th>Участников</th><th>Действие</th>
  </tr>
  {% for g in groups %}
  <tr class="group_row">
    <td>{{ g.id }}</td>
    <td>
      <div style="max-height: 150px; overflow-y: auto; border: 1px solid #eee; padding: 5px;">
        {{ g.groupname }}
      </div>
    </td>
    <td>
        <div style="max-height: 150px; overflow-y: auto; border: 1px solid #eee; padding: 5px;">
            {{ g.users|length }}
        </div>
    </td>
    <td>
      <div class="actions">
          <a href="{{ url_for('group_edit', group_id=g.id) }}"
             class="btn btn-action">Редактировать</a>

          <span class="action-divider">/</span>

          <form action="{{ url_for('group_delete', group_id=g.id) }}"
                method="post" style="display:inline;">
              <button type="submit"
                      onclick="return confirm('Удалить?')"
                      class="btn btn-action">Удалить</button>
          </form>
      </div>
    </td>
  </tr>
  {% endfor %}
</table>

<script>
    function searchTable() {
      const searchName = document.getElementById('searchName').value.toLowerCase();
      const searchID = document.getElementById('searchID').value.toLowerCase();

      const rows = document.querySelectorAll('table tr.group_row');

      rows.forEach(row => {
        const cells = row.getElementsByTagName('td');
        if (cells.length >= 3) {
          const id = cells[0].textContent.toLowerCase();
          const name = cells[1].textContent.toLowerCase();

          let show = true;

          if (searchID && !id.includes(searchID)) show = false;
          if (searchName && !name.includes(searchName)) show = false;

          row.style.display = show ? '' : 'none';
        }
      });
    }

    function clearSearch() {
      document.getElementById('searchName').value = '';
      document.getElementById('searchID').value = '';

      const rows = document.querySelectorAll('tr.group_row, tr.group-row');
      rows.forEach(row => {
        row.style.display = '';
      });
    }
</script>
{% endblock %}
{% set show_footer = False %}